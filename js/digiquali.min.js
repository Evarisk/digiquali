window.digiquali||(window.digiquali={},window.digiquali.scriptsLoaded=!1),window.digiquali.scriptsLoaded||(window.digiquali.init=function(){window.digiquali.load_list_script()},window.digiquali.load_list_script=function(){if(!window.digiquali.scriptsLoaded){var t=void 0,e=void 0;for(t in window.digiquali)for(e in window.digiquali[t].init&&window.digiquali[t].init(),window.digiquali[t])window.digiquali[t]&&window.digiquali[t][e]&&window.digiquali[t][e].init&&window.digiquali[t][e].init();window.digiquali.scriptsLoaded=!0}},window.digiquali.refresh=function(){var t=void 0,e=void 0;for(t in window.digiquali)for(e in window.digiquali[t].refresh&&window.digiquali[t].refresh(),window.digiquali[t])window.digiquali[t]&&window.digiquali[t][e]&&window.digiquali[t][e].refresh&&window.digiquali[t][e].refresh()},$(document).ready(window.digiquali.init)),window.digiquali.activity={},window.digiquali.activity.init=function(){window.digiquali.activity.event()},window.digiquali.activity.event=function(){$(document).on("input","#myTextareadsf",window.digiquali.activity.updateModalActivityAddButton),$(document).on("blur",'[contenteditable="true"]',window.digiquali.activity.updateContentEditable),$(document).on("click","#activity_create",window.digiquali.activity.createActivity),$(document).on("click","#activity_update",window.digiquali.activity.updateActivity)},window.digiquali.activity.updateModalActivityAddButton=function(){var t=$(this),e=t.closest("#activity_add").find("#activity_create");0<t.val().length?e.removeClass("button-disable"):e.addClass("button-disable")},window.digiquali.activity.updateContentEditable=function(){var t=window.saturne.toolbox.getQuerySeparator(document.URL),e=window.saturne.toolbox.getToken(),i=$(this),a=$(this).closest(".activity-container").data("object-id"),n=i.data("field"),i=i.text();$.ajax({url:""+document.URL+t+"&action=update_activity&token="+e,type:"POST",data:JSON.stringify({object_id:a,field:n,value:i})})},window.digiquali.activity.createActivity=function(){var t=window.saturne.toolbox.getToken();const e=$(this).closest("#activity_add");var i=e.data("from-id"),a=e.data("from-type");const n=$(document).find("#activity-list-container");var o=e.find("#myTextareadsf").val();window.saturne.loader.display(n),$.ajax({url:document.URL+"&action=add_activity&token="+t,type:"POST",data:JSON.stringify({objectLine_id:i,objectLine_element:a,label:o,token:t}),success:function(t){e.replaceWith($(t).find("#activity_add")),n.replaceWith($(t).find("#activity-list-container"))}})},window.digiquali.activity.updateActivity=function(){var t=window.saturne.toolbox.getToken();const e=$(this).closest("#activity_edit");var i=e.data("from-id"),a=e.data("from-type");const n=$(document).find("#activity-list-container");var o=e.find("#myTextareadsf").val();window.saturne.loader.display(n),$.ajax({url:document.URL+"&action=update_activity&token="+t,type:"POST",data:JSON.stringify({object_id:i,object_element:a,label:o}),success:function(t){e.replaceWith($(t).find("#activity_edit")),n.replaceWith($(t).find("#activity-list-container"))}})},window.digiquali.control={},window.digiquali.control.init=function(){window.digiquali.control.event()},window.digiquali.control.event=function(){$(document).on("click",".validateButton",window.digiquali.control.getAnswerCounter),$(document).on("change","#fk_sheet",window.digiquali.control.showSelectObjectLinked),$(document).on("click",".clipboard-copy",window.digiquali.control.copyToClipboard),$(document).on("change","#productId",window.digiquali.control.refreshLotSelector),$(document).on("click",".switch-public-control-view",window.digiquali.control.switchPublicControlView),$(document).on("click",".photo-sheet-category",window.digiquali.control.getSheetCategoryID),$(document).on("click",".photo-sheet-sub-category",window.digiquali.control.getSheetSubCategoryID),$(document).on("click",".photo-sheet",window.digiquali.control.getSheetID),$(document).on("click","[data-toggle-action]",function(){var t=$(this).data("toggle-action"),e=$(this).data("toggle-key");t&&e&&window.saturne.utils.toggleSetting.call(this,t,e)})},window.digiquali.control.getAnswerCounter=function(t){let e=0;jQuery("#tablelines").children().each(function(){0<$(this).find(".answer.active").length&&(e+=1)}),document.cookie="answerCounter="+e},window.digiquali.control.showSelectObjectLinked=function(){var t=$(this).val(),e=window.saturne.toolbox.getToken(),i=window.saturne.toolbox.getQuerySeparator(document.URL),i=document.URL+i+"fk_sheet="+t+"&token="+e;window.saturne.loader.display($(".linked-objects")),$.ajax({url:i,type:"POST",processData:!1,contentType:!1,success:function(t){$(".linked-objects").replaceWith($(t).find(".linked-objects"))},error:function(){}})},window.digiquali.control.copyToClipboard=function(t){var e=$(".copy-to-clipboard").attr("value");navigator.clipboard.writeText(e).then(()=>{$(".clipboard-copy").animate({backgroundColor:"#59ed9c"},200,()=>{$(".clipboard-copy").attr("class","fas fa-check  clipboard-copy"),$(this).tooltip({items:".clipboard-copy",content:$("#copyToClipboardTooltip").val()}),$(this).tooltip("open"),$(".clipboard-copy").attr("style","")})})},window.digiquali.control.refreshLotSelector=function(t){var e=document.getElementById("add_control_equipment"),e=new FormData(e),i=window.saturne.toolbox.getToken(),e=e.get("productId"),i=document.URL+"&token="+i;i+="&fk_product="+e,window.saturne.loader.display($(".product-lot")),$.ajax({url:i,type:"POST",processData:!1,contentType:!1,success:function(t){$(".product-lot").replaceWith($(t).find(".product-lot"))},error:function(){}})},window.digiquali.control.switchPublicControlView=function(){var t=$(this).data("route");window.saturne.loader.display($(this)),$.ajax({url:document.URL+"&route="+t,type:"POST",processData:!1,contentType:!1,success:function(t){$(".public-card__container").children().fadeOut(300,function(){$("#publicControlHistory").replaceWith($(t).find("#publicControlHistory"))})},error:function(){}})},window.digiquali.control.getSheetCategoryID=function(){let e=$(this).attr("value");var t=window.saturne.toolbox.getToken(),i=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".sheet-images-container")),$.ajax({url:document.URL+i+"sheetCategoryID="+e+"&token="+t,type:"POST",processData:!1,contentType:!1,success:function(t){$(".sheet-images-container").replaceWith($(t).find(".sheet-images-container")),$(".photo-sheet-category[value="+e+"]").css("border","3px solid #0d8aff"),$(".photo-sheet-category[value="+e+"]").addClass("photo-sheet-category-active"),$(".linked-objects").replaceWith($(t).find(".linked-objects"))},error:function(){}})},window.digiquali.control.getSheetSubCategoryID=function(){let e=$(".photo-sheet-category-active").attr("value"),i=$(this).attr("value");var t=window.saturne.toolbox.getToken(),a=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".sheet-images-container")),$.ajax({url:document.URL+a+"sheetCategoryID="+e+"&sheetSubCategoryID="+i+"&token="+t,type:"POST",processData:!1,contentType:!1,success:function(t){$(".sheet-images-container").replaceWith($(t).find(".sheet-images-container")),$(".photo-sheet-category[value="+e+"]").css("border","3px solid #0d8aff"),$(".photo-sheet-category[value="+e+"]").addClass("photo-sheet-category-active"),$(".photo-sheet-sub-category[value="+i+"]").css("border","3px solid #0d8aff"),$(".photo-sheet-sub-category[value="+i+"]").addClass("photo-sheet-sub-category-active"),$(".linked-objects").replaceWith($(t).find(".linked-objects"))},error:function(){}})},window.digiquali.control.getSheetID=function(){let e=$(this).attr("data-object-id");var t=$(".photo-sheet-category-active").attr("value"),i=$(".photo-sheet-sub-category-active").attr("value"),a=window.saturne.toolbox.getToken(),n=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".sheet-elements")),window.saturne.loader.display($(".linked-objects")),$.ajax({url:document.URL+n+"fk_sheet="+e+"&sheetCategoryID="+t+"&sheetSubCategoryID="+i+"&token="+a,type:"POST",processData:!1,contentType:!1,success:function(t){$(".sheet-elements").replaceWith($(t).find(".sheet-elements")),$(".photo-sheet[data-object-id="+e+"]").css("border","3px solid #0d8aff"),$(".linked-objects").replaceWith($(t).find(".linked-objects"))},error:function(){}})},window.digiquali.object={},window.digiquali.object.init=function(){window.digiquali.object.event(),window.digiquali.object.placePercents()},window.digiquali.object.event=function(){$(document).on("change",".object-table.linked-objects select",window.digiquali.object.disableOtherSelectors),$(document).on("click",".answer:not(.disable)",window.digiquali.object.selectAnswer),$(document).on("input",".input-answer:not(.disable)",window.digiquali.object.selectAnswer),$(document).on("keyup",".question-comment",window.digiquali.object.showCommentUnsaved),$(document).on("change",".question-answer",window.digiquali.object.changeStatusQuestion),$(document).on("click",".answer:not(.disable)",window.digiquali.object.changeStatusQuestion),$(document).on("input",'.question-answer[type="range"]',window.digiquali.object.rangePercent)},window.digiquali.object.disableOtherSelectors=function(){var t=document.getElementById("createObjectForm"),t=new FormData(t),e=$(this).attr("id");0<=t.get(e)?$(".object-table.linked-objects").find("select").not("#"+e).attr("disabled",1):$(".object-table.linked-objects").find("select").not("#"+e).removeAttr("disabled")},window.digiquali.object.selectAnswer=function(){var e=$(this).closest(".select-answer.answer-cell"),t=e.attr("data-questionId"),i=$(this).closest(".table-id-"+t).attr("data-publicInterface"),a=$(this).closest(".table-id-"+t).attr("data-autoSave");let n="";var o=$(this).hasClass("answer")?$(this).attr("value"):$(this).val(),s=$(this).closest(".table-id-"+t).find("#comment"+t).val(),d=$(this).closest(".group-question").attr("id");if($(this).closest(".table-cell").hasClass("select-answer")){if($(this).hasClass("multiple-answers")){$(this).closest("span").toggleClass("active");let t=[];e.find(".multiple-answers.active").each(function(){t.push($(this).attr("value"))}),n=t}else $(this).closest(".table-cell").find(".answer.active").css("background-color","#fff"),$(this).closest(".table-cell").find("span").removeClass("active"),$(this).closest("span").addClass("active"),n=o;$(this).hasClass("active")?(e=$(this).closest(".answer-cell").find(".answer-color-"+$(this).attr("value")).val(),$(this).attr("style",$(this).attr("style")+" background:"+e+";")):$(this).attr("style",$(this).attr("style")+" background:#fff;"),$(this).closest(".answer-cell").find(".question-answer").val(n)}i||1!=a||$(this).hasClass("multiple-answers")?window.digiquali.object.updateButtonsStatus():window.digiquali.object.saveAnswer(t,n,s,d)},window.digiquali.object.changeStatusQuestion=function(){$(this).closest(".question").addClass("question-complete")},window.digiquali.object.showCommentUnsaved=function(){$(this).hasClass("show-comment-unsaved-message")||$(".question-answer-container").hasClass("question-answer-container-pwa")||($(this).after('<p style="color:red;">Commentaire non enregistr√©</p>'),$(this).addClass("show-comment-unsaved-message")),window.digiquali.object.updateButtonsStatus()},window.digiquali.object.updateButtonsStatus=function(){$("#saveButton").removeClass("butActionRefused"),$("#saveButton").addClass("butAction"),$("#saveButton").css("background","#0d8aff"),$(".fa-circle").css("display","inline"),$("#saveButton").attr("onclick",'$("#saveObject").submit()'),$(".validateButton").removeClass("butAction"),$("#dialog-confirm-actionButtonValidate").removeAttr("id"),$(".validateButton").addClass("butActionRefused")},window.digiquali.object.saveAnswer=function(t,e,i,a){var n=window.saturne.toolbox.getToken(),o=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".table-id-"+t)),$.ajax({url:document.URL+o+"action=save&token="+n,type:"POST",data:JSON.stringify({autoSave:!0,questionId:t,answer:e,comment:i,questionGroup:a}),processData:!1,contentType:!1,success:function(t){$(".fiche").replaceWith($(t).find(".fiche")),$("#dialog-confirm-actionButtonValidate>.confirmmessage").replaceWith($(t).find("#dialog-confirm-actionButtonValidate>.confirmmessage"))},error:function(){}})},window.digiquali.object.rangePercent=function(){var t=window.saturne.toolbox.isPhone(),e=$(this),i=parseFloat(e.val()),a=parseInt(e.attr("min")),n=parseInt(e.attr("max")),o=e.width(),s=e.position().left,d=e.position().top,c=t?36:70,l=(e.parent().find(".range-percent").remove(),(Math.round(100*i)/100).toFixed(2)),r=$('<span class="range-percent">'+l+"%</span>"),d=(t||r.css("transform","translateX(0)"),r.addClass("badge badge-primary"),r.css("top",d-1.05*c/2-(t?10:5)+"px"),(i-a)/(n-a)),i=s+Math.round(d*o-(t?0:c/4)+-c*(d-.5));r.css("left",i),e.attr("value",l),e.parent().append(r)},window.digiquali.object.placePercents=function(){$('.question-answer[type="range"]').each(function(){window.digiquali.object.rangePercent.call(this)})},window.digiquali.question={},window.digiquali.question.init=function(){window.digiquali.question.event()},window.digiquali.question.event=function(){$(document).on("click",".clicked-photo-preview",window.digiquali.question.previewPhoto),$(document).on("click",".ui-dialog-titlebar-close",window.digiquali.question.closePreviewPhoto),$(document).on("click","#show_photo",window.digiquali.question.showPhoto),$(document).on("click",".answer-picto .item, .wpeo-table .item",window.digiquali.question.selectAnswerPicto),$(document).on("change",'select[data-type="question-type"]',window.digiquali.question.changeQuestionType)},window.digiquali.question.previewPhoto=function(){$(this).hasClass("photo-ok")?$("#dialogforpopup").attr("style","border: 10px solid #47e58e"):$(this).hasClass("photo-ko")&&$("#dialogforpopup").attr("style","border: 10px solid #e05353")},window.digiquali.question.closePreviewPhoto=function(){$("#dialogforpopup").attr("style","border:")},window.digiquali.question.showPhoto=function(){var t=$(this);t.closest(".question-table").find(".linked-medias").toggleClass("hidden",!t.prop("checked"))},window.digiquali.question.selectAnswerPicto=function(){var t=$(this).closest(".wpeo-dropdown");$(this).closest(".content").removeClass("active"),t.find(".dropdown-toggle span").hide(),t.find(".dropdown-toggle.button-picto").html($(this).closest(".wpeo-tooltip-event").html()),t.find(".input-hidden-picto").val($(this).data("label"))},window.digiquali.question.changeQuestionType=function(){"Percentage"===$(this).val()?$(document).find("#percentage-question-step").removeClass("hidden"):$(document).find("#percentage-question-step").addClass("hidden")},window.digiquali.riskassessment={},window.digiquali.riskassessment.init=function(){window.digiquali.riskassessment.event()},window.digiquali.riskassessment.event=function(){$(document).on("click",".gravity-button",window.digiquali.riskassessment.updateGravityPercentage),$(document).on("change","#gravity-percentage-input",window.digiquali.riskassessment.updateGravityPercentage),$(document).on("click",".frequency-button",window.digiquali.riskassessment.updateFrequencyPercentage),$(document).on("change","#frequency-percentage-input",window.digiquali.riskassessment.updateFrequencyPercentage),$(document).on("input","#control-slider",window.digiquali.riskassessment.updateControlPercentage),$(document).on("change","#control-percentage-input",window.digiquali.riskassessment.updateControlPercentage),$(document).on("change","#risk-control-input",function(){var t=parseFloat($(this).val());!isNaN(t)&&0<=t&&t<=100&&$("#control-slider").val(t),window.digiquali.riskassessment.updateControlPercentage.call(this)}),$(document).on("click","#riskassessment_create",window.digiquali.riskassessment.createRiskAssessment),$(document).on("click","#riskassessment_update",window.digiquali.riskassessment.updateRiskAssessment)},window.digiquali.riskassessment.updateGravityPercentage=function(){var t=$(this),t=(t.closest(".gravity-buttons").find(".gravity-button").removeClass("selected"),t.addClass("selected"),t.data("gravity-value"));$("#gravity-percentage-input").val(t),window.digiquali.riskassessment.calculateAndDisplayRisks(),window.digiquali.riskassessment.updateModalRiskAssessmentAddButton()},window.digiquali.riskassessment.updateFrequencyPercentage=function(){var t=$(this),e=t.closest(".frequency-buttons").find(".frequency-button").removeClass("selected");let i;if(t.is("button"))i=t.data("frequency-value"),t.addClass("selected");else if(t.is("input")){i=parseFloat(t.val()),isNaN(i)&&(i=0);e.each(function(){if($(this).data("frequency-value")===i)return $(this).addClass("selected"),!1}),i=Math.max(0,Math.min(100,i)),t.val(i)}$("#frequency-percentage-input").val(i),window.digiquali.riskassessment.calculateAndDisplayRisks(),window.digiquali.riskassessment.updateModalRiskAssessmentAddButton()},window.digiquali.riskassessment.updateControlPercentage=function(){var t=$(this).val();$("#control-percentage-input").val(t),window.digiquali.riskassessment.calculateAndDisplayRisks(),window.digiquali.riskassessment.updateModalRiskAssessmentAddButton()},window.digiquali.riskassessment.calculateAndDisplayRisks=function(){var t=(e=(parseFloat($("#gravity-percentage-input").val())||0)/100*((parseFloat($("#frequency-percentage-input").val())||0)/100))*(1-(parseFloat($("#control-percentage-input").val())||0)/100),e=(100*e).toFixed(2),t=(100*t).toFixed(2),i=$("#risk-percentage-value"),a=$("#residual-risk-percentage-value");i.text(e+"%"),a.text(t+"%"),75<=e?i.removeClass("grey yellow red").addClass("black"):50<=e?i.removeClass("grey yellow black").addClass("red"):25<=e?i.removeClass("grey red black").addClass("yellow"):i.removeClass("yellow red black").addClass("grey"),75<=t?a.removeClass("grey yellow red").addClass("black"):50<=t?a.removeClass("grey yellow black").addClass("red"):25<=t?a.removeClass("grey red black").addClass("yellow"):a.removeClass("yellow red black").addClass("grey")},window.digiquali.riskassessment.updateModalRiskAssessmentAddButton=function(){var t=$("#riskassessment_add").find("#riskassessment_create"),e=parseFloat($("#gravity-percentage-input").val()),i=parseFloat($("#frequency-percentage-input").val()),a=parseFloat($("#control-percentage-input").val()),e=!isNaN(e)&&0<=e&&e<=100,i=!isNaN(i)&&0<=i&&i<=100,a=!isNaN(a)&&0<=a&&a<=100;e&&i&&a?t.removeClass("button-disable").prop("disabled",!1):t.addClass("button-disable").prop("disabled",!0)},window.digiquali.riskassessment.createRiskAssessment=function(){var t=window.saturne.toolbox.getToken();const e=$(this).closest("#riskassessment_add"),i=e.data("from-id");var a=e.data("from-type");const n=$(document).find("#riskassessment_list_container_"+i);var o=e.find("#comment").val(),s=e.find("#gravity-percentage-input").val(),d=e.find("#frequency-percentage-input").val(),c=e.find("#control-percentage-input").val();window.saturne.loader.display(n),$.ajax({url:document.URL+"&action=add_riskassessment&token="+t,type:"POST",contentType:"application/json",data:JSON.stringify({objectLine_id:i,objectLine_element:a,comment:o,gravity_percentage:s,frequency_percentage:d,control_percentage:c}),success:function(t){e.replaceWith($(t).find("#riskassessment_add")),n.replaceWith($(t).find("#riskassessment_list_container_"+i))}})},window.digiquali.riskassessment.updateRiskAssessment=function(){var t=window.saturne.toolbox.getToken();const e=$(this).closest("#riskassessment_edit");var i=e.data("from-id"),a=e.data("from-type");const n=$(document).find("#riskassessment-list-container");var o=e.find("#myTextareadsf").val();window.saturne.loader.display(n),$.ajax({url:document.URL+"&action=update_riskassessment&token="+t,type:"POST",data:JSON.stringify({object_id:i,object_element:a,label:o}),success:function(t){e.replaceWith($(t).find("#riskassessment_edit")),n.replaceWith($(t).find("#riskassessment-list-container"))}})},window.digiquali.sheet={},window.digiquali.sheet.init=function(){window.digiquali.sheet.event()},window.digiquali.sheet.event=function(){$(document).on("click",".toggle-group-in-tree",window.digiquali.sheet.toggleGroupInTree),$(document).on("click","#addQuestionButton, #addGroupButton",window.digiquali.sheet.buttonActions),$(document).on("mouseenter",".sheet-move-line.ui-sortable-handle",window.digiquali.sheet.draganddrop)},window.digiquali.sheet.buttonActions=function(){var t=$("#addQuestionRow"),e=$("#addGroupRow");("addQuestionButton"===$(this).attr("id")?(t.removeClass("hidden"),e):(e.removeClass("hidden"),t)).addClass("hidden")},window.digiquali.sheet.toggleGroup=function(t){var e=$(".group-question-"+t);const i=$(`#group-${t} .toggle-icon`);e.each(function(){var t=$(this).toggleClass("hidden").hasClass("hidden");i.text(t?"+":"-")})},window.digiquali.sheet.closeAllGroups=function(){var t=$(".group-question"),e=$(".toggle-icon");t.addClass("hidden"),e.text("+")},window.digiquali.sheet.toggleGroupInTree=function(){var t=$(this).closest(".group-item").next()[0];$(this).toggleClass("fa-chevron-up fa-chevron-down"),t&&t.classList.contains("sub-questions")&&t.classList.toggle("collapsed")},window.digiquali.sheet.greyOut=function(){var t=$(".group-item"),e=$(".question-item"),i=$(".sheet-header");t.removeClass("selected"),e.removeClass("selected"),i.removeClass("selected")},window.digiquali.sheet.draganddrop=function(){$(this).css("cursor","pointer"),$("#tablelines tbody").sortable({handle:".sheet-move-line",connectWith:"#tablelines tbody .line-row",tolerance:"intersect",over:function(){$(this).css("cursor","grabbing")},stop:function(){$(this).css("cursor","default");var t=$(".fiche").find('input[name="token"]').val();let e="&",i=(document.URL.match(/action=/)&&(document.URL=document.URL.split(/\?/)[0],e="?"),[]);$(".line-row").each(function(){i.push($(this).attr("id"))}),window.saturne.loader.display($(".side-nav .question-list")),$.ajax({url:document.URL+e+"action=moveLine&token="+t,type:"POST",data:JSON.stringify({order:i}),processData:!1,contentType:!1,success:function(t){$(".side-nav .question-list").html($(t).find(".side-nav .question-list")),window.saturne.loader.remove($(".side-nav .question-list"))},error:function(){}})}})},window.digiquali.task={},window.digiquali.task.init=function(){window.digiquali.task.event()},window.digiquali.task.event=function(){$(document).on("input","#answer-task-label",window.digiquali.task.updateModalTaskAddButton),$(document).on("click",".answer-task-create:not(.button-disable)",window.digiquali.task.createTask),$(document).on("click",".answer-task-save",window.digiquali.task.updateTask),$(document).on("click",".question__action .delete-task",window.digiquali.task.deleteTask),$(document).on("change",'.question__action-check input[type="checkbox"]',window.digiquali.task.checkTask),$(document).on("click",".answer-task-timespent-create",window.digiquali.task.createTaskTimeSpent),$(document).on("click",".answer-task-timespent-update",window.digiquali.task.updateTaskTimeSpent),$(document).on("click",".answer-task-timespent-delete",window.digiquali.task.deleteTaskTimeSpent)},window.digiquali.task.updateModalTaskAddButton=function(){var t=$(this),e=t.closest("#answer_task_add").find(".wpeo-button.answer-task-create");0<t.val().length?e.removeClass("button-disable"):e.addClass("button-disable")},window.saturne.modal.addMoreOpenModalData=function(e,t){var i=window.saturne.toolbox.getToken(),t=t.find(".modal-options").data("from-id");let a="fetch_task";e.match(/timespent_edit/)&&(a="fetch_task_timespent"),"activity_edit"===e&&(a="fetch_activity"),$.ajax({url:`${document.URL}&action=${a}&token=`+i,type:"POST",data:JSON.stringify({from_id:t}),success:function(t){$("#"+e).replaceWith($(t).find("#"+e).addClass("modal-active"))}})},window.digiquali.task.createTask=function(){var t=window.saturne.toolbox.getToken();const e=$(this).closest("#answer_task_add"),i=e.data("from-id");var a=e.data("from-type");const n=$(document).find("#question_task_list"+i);var o=e.find("#answer-task-label").val(),s=e.find("#answer-task-start-date").val(),d=e.find("#answer-task-end-date").val(),c=e.find("#answer-task-budget").val(),l=e.data("project-id");$.ajax({url:document.URL+"&action=add_task&token="+t,type:"POST",data:JSON.stringify({objectLine_id:i,objectLine_element:a,label:o,date_start:s,date_end:d,budget_amount:c,fk_project:l,token:t}),success:function(t){e.replaceWith($(t).find("#answer_task_add")),n.replaceWith($(t).find("#question_task_list"+i))}})},window.digiquali.task.updateTask=function(){var t=window.saturne.toolbox.getToken(),e=$(this);const i=e.closest("#answer_task_edit");var a=i.find(".answer-task-content");const n=e.data("task-id"),o=$(document).find(`#answer_task${n} .question__action-body`);var e=a.find("#answer-task-label").val(),s=a.find("#answer-task-start-date").val(),d=a.find("#answer-task-end-date").val(),a=a.find("#answer-task-budget").val();$.ajax({url:document.URL+"&action=update_task&token="+t,type:"POST",data:JSON.stringify({task_id:n,label:e,date_start:s,date_end:d,budget:a}),success:function(t){i.removeClass("modal-active"),o.replaceWith($(t).find(`#answer_task${n} .question__action-body`))}})},window.digiquali.task.deleteTask=function(){var t=window.saturne.toolbox.getToken(),e=$(this);const i=e.closest(".question__list-actions");var a=i.data("objectline-id"),n=i.data("objectline-element"),o=e.data("task-id"),e=e.data("message");confirm(e)&&$.ajax({url:document.URL+"&action=delete_task&token="+t,type:"POST",data:JSON.stringify({objectLine_id:a,objectLine_element:n,task_id:o}),success:function(t){var e=i.attr("id");i.replaceWith($(t).find("#"+e))}})},window.digiquali.task.checkTask=function(){var t=window.saturne.toolbox.getToken();const e=$(this).closest(".question__action"),i=e.data("task-id");window.saturne.loader.display(e),$.ajax({url:`${document.URL}&action=check_task&task_id=${i}&token=`+t,type:"POST",success:function(t){e.replaceWith($(t).find("#answer_task"+i))}})},window.digiquali.task.createTaskTimeSpent=function(){var t=window.saturne.toolbox.getToken(),e=$(this).closest("#answer_task_timespent_add");const i=e.data("task-id"),a=$(document).find("#answer_task"+i);var n=e.find("#answer-task-timespent-comment").val(),o=e.find("#answer-task-timespent-date").val(),e=e.find("#answer-task-timespent-duration").val();window.saturne.loader.display(a),$.ajax({url:document.URL+"&action=add_task_timespent&token="+t,type:"POST",data:JSON.stringify({task_id:i,comment:n,date:o,duration:e}),success:function(t){a.replaceWith($(t).find("#answer_task"+i))}})},window.digiquali.task.updateTaskTimeSpent=function(){var t=window.saturne.toolbox.getToken(),e=$(this).closest("#answer_task_timespent_edit");const i=e.data("task-timespent-id"),a=$(document).find("#answer_task_timespent_view"+i);var n=e.find("#answer-task-timespent-comment").val(),o=e.find("#answer-task-timespent-date").val(),e=e.find("#answer-task-timespent-duration").val();window.saturne.loader.display(a),$.ajax({url:document.URL+"&action=update_task_timespent&token="+t,type:"POST",data:JSON.stringify({task_timespent_id:i,comment:n,date:o,duration:e}),success:function(t){a.replaceWith($(t).find("#answer_task_timespent_view"+i))}})},window.digiquali.task.deleteTaskTimeSpent=function(){var t=window.saturne.toolbox.getToken(),e=$(this),i=e.closest("#answer_task_timespent_list");const a=i.find(".answer-task-timespent-container"),n=i.data("task-id"),o=$(document).find(`#answer_task${n} .question__action-body`);i=e.data("task-timespent-id"),e=e.data("message");confirm(e)&&(window.saturne.loader.display(a),window.saturne.loader.display(o),$.ajax({url:document.URL+"&action=delete_task_timespent&token="+t,type:"POST",data:JSON.stringify({task_timespent_id:i}),success:function(t){a.replaceWith($(t).find(`#answer_task_timespent_list[data-task-id="${n}"] .answer-task-timespent-container`)),o.replaceWith($(t).find(`#answer_task${n} .question__action-body`))}}))};