window.digiquali||(window.digiquali={},window.digiquali.scriptsLoaded=!1),window.digiquali.scriptsLoaded||(window.digiquali.init=function(){window.digiquali.load_list_script()},window.digiquali.load_list_script=function(){if(!window.digiquali.scriptsLoaded){var e=void 0,t=void 0;for(e in window.digiquali)for(t in window.digiquali[e].init&&window.digiquali[e].init(),window.digiquali[e])window.digiquali[e]&&window.digiquali[e][t]&&window.digiquali[e][t].init&&window.digiquali[e][t].init();window.digiquali.scriptsLoaded=!0}},window.digiquali.refresh=function(){var e=void 0,t=void 0;for(e in window.digiquali)for(t in window.digiquali[e].refresh&&window.digiquali[e].refresh(),window.digiquali[e])window.digiquali[e]&&window.digiquali[e][t]&&window.digiquali[e][t].refresh&&window.digiquali[e][t].refresh()},$(document).ready(window.digiquali.init)),window.digiquali.activity={},window.digiquali.activity.init=function(){window.digiquali.activity.event()},window.digiquali.activity.event=function(){$(document).on("input","#label",window.digiquali.activity.updateModalActivityButton),$(document).on("blur",'[contenteditable="true"]',window.digiquali.activity.updateContentEditable),$(document).on("click","#activity_add",function(){window.saturne.object.ObjectFromModal.call(this,"create","activity")})},window.digiquali.activity.updateModalActivityButton=function(){var e=$(this),t=e.closest("#activity_create").find("#activity_add");0<e.val().length?t.removeClass("button-disable"):t.addClass("button-disable")},window.digiquali.activity.updateContentEditable=function(){var e=window.saturne.toolbox.getQuerySeparator(document.URL),t=window.saturne.toolbox.getToken(),i=$(this),n=$(this).closest(".activity-container").data("object-id"),a=i.data("field"),i=i.text();$.ajax({url:""+document.URL+e+"&action=update_activity&token="+t,type:"POST",data:JSON.stringify({object_id:n,field:a,value:i})})},window.digiquali.control={},window.digiquali.control.init=function(){window.digiquali.control.event()},window.digiquali.control.event=function(){$(document).on("click",".validateButton",window.digiquali.control.getAnswerCounter),$(document).on("change","#fk_sheet",window.digiquali.control.showSelectObjectLinked),$(document).on("click",".clipboard-copy",window.digiquali.control.copyToClipboard),$(document).on("change","#productId",window.digiquali.control.refreshLotSelector),$(document).on("click",".switch-public-control-view",window.digiquali.control.switchPublicControlView),$(document).on("click",".photo-sheet-category",window.digiquali.control.getSheetCategoryID),$(document).on("click",".photo-sheet-sub-category",window.digiquali.control.getSheetSubCategoryID),$(document).on("click",".photo-sheet",window.digiquali.control.getSheetID),$(document).on("click","[data-toggle-action]",function(){var e=$(this).data("toggle-action"),t=$(this).data("toggle-key");e&&t&&window.saturne.utils.toggleSetting.call(this,e,t)})},window.digiquali.control.getAnswerCounter=function(e){let t=0;jQuery("#tablelines").children().each(function(){0<$(this).find(".answer.active").length&&(t+=1)}),document.cookie="answerCounter="+t},window.digiquali.control.showSelectObjectLinked=function(){var e=$(this).val(),t=window.saturne.toolbox.getToken(),i=window.saturne.toolbox.getQuerySeparator(document.URL),i=document.URL+i+"fk_sheet="+e+"&token="+t;window.saturne.loader.display($(".linked-objects")),$.ajax({url:i,type:"POST",processData:!1,contentType:!1,success:function(e){$(".linked-objects").replaceWith($(e).find(".linked-objects"))},error:function(){}})},window.digiquali.control.copyToClipboard=function(e){var t=$(".copy-to-clipboard").attr("value");navigator.clipboard.writeText(t).then(()=>{$(".clipboard-copy").animate({backgroundColor:"#59ed9c"},200,()=>{$(".clipboard-copy").attr("class","fas fa-check  clipboard-copy"),$(this).tooltip({items:".clipboard-copy",content:$("#copyToClipboardTooltip").val()}),$(this).tooltip("open"),$(".clipboard-copy").attr("style","")})})},window.digiquali.control.refreshLotSelector=function(e){var t=document.getElementById("add_control_equipment"),t=new FormData(t),i=window.saturne.toolbox.getToken(),t=t.get("productId"),i=document.URL+"&token="+i;i+="&fk_product="+t,window.saturne.loader.display($(".product-lot")),$.ajax({url:i,type:"POST",processData:!1,contentType:!1,success:function(e){$(".product-lot").replaceWith($(e).find(".product-lot"))},error:function(){}})},window.digiquali.control.switchPublicControlView=function(){var e=$(this).data("route");window.saturne.loader.display($(this)),$.ajax({url:document.URL+"&route="+e,type:"POST",processData:!1,contentType:!1,success:function(e){$(".public-card__container").children().fadeOut(300,function(){$("#publicControlHistory").replaceWith($(e).find("#publicControlHistory"))})},error:function(){}})},window.digiquali.control.getSheetCategoryID=function(){let t=$(this).attr("value");var e=window.saturne.toolbox.getToken(),i=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".sheet-images-container")),$.ajax({url:document.URL+i+"sheetCategoryID="+t+"&token="+e,type:"POST",processData:!1,contentType:!1,success:function(e){$(".sheet-images-container").replaceWith($(e).find(".sheet-images-container")),$(".photo-sheet-category[value="+t+"]").css("border","3px solid #0d8aff"),$(".photo-sheet-category[value="+t+"]").addClass("photo-sheet-category-active"),$(".linked-objects").replaceWith($(e).find(".linked-objects"))},error:function(){}})},window.digiquali.control.getSheetSubCategoryID=function(){let t=$(".photo-sheet-category-active").attr("value"),i=$(this).attr("value");var e=window.saturne.toolbox.getToken(),n=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".sheet-images-container")),$.ajax({url:document.URL+n+"sheetCategoryID="+t+"&sheetSubCategoryID="+i+"&token="+e,type:"POST",processData:!1,contentType:!1,success:function(e){$(".sheet-images-container").replaceWith($(e).find(".sheet-images-container")),$(".photo-sheet-category[value="+t+"]").css("border","3px solid #0d8aff"),$(".photo-sheet-category[value="+t+"]").addClass("photo-sheet-category-active"),$(".photo-sheet-sub-category[value="+i+"]").css("border","3px solid #0d8aff"),$(".photo-sheet-sub-category[value="+i+"]").addClass("photo-sheet-sub-category-active"),$(".linked-objects").replaceWith($(e).find(".linked-objects"))},error:function(){}})},window.digiquali.control.getSheetID=function(){let t=$(this).attr("data-object-id");var e=$(".photo-sheet-category-active").attr("value"),i=$(".photo-sheet-sub-category-active").attr("value"),n=window.saturne.toolbox.getToken(),a=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".sheet-elements")),window.saturne.loader.display($(".linked-objects")),$.ajax({url:document.URL+a+"fk_sheet="+t+"&sheetCategoryID="+e+"&sheetSubCategoryID="+i+"&token="+n,type:"POST",processData:!1,contentType:!1,success:function(e){$(".sheet-elements").replaceWith($(e).find(".sheet-elements")),$(".photo-sheet[data-object-id="+t+"]").css("border","3px solid #0d8aff"),$(".linked-objects").replaceWith($(e).find(".linked-objects"))},error:function(){}})},window.digiquali.object={},window.digiquali.object.init=function(){window.digiquali.object.event(),window.digiquali.object.placePercents()},window.digiquali.object.event=function(){$(document).on("change",".object-table.linked-objects select",window.digiquali.object.disableOtherSelectors),$(document).on("click",".answer:not(.disable)",window.digiquali.object.selectAnswer),$(document).on("input",".input-answer:not(.disable)",window.digiquali.object.selectAnswer),$(document).on("keyup",".question-comment",window.digiquali.object.showCommentUnsaved),$(document).on("change",".question-answer",window.digiquali.object.changeStatusQuestion),$(document).on("click",".answer:not(.disable)",window.digiquali.object.changeStatusQuestion),$(document).on("input",'.question-answer[type="range"]',function(){window.digiquali.object.rangePercent.call(this,!1)})},window.digiquali.object.disableOtherSelectors=function(){var e=document.getElementById("createObjectForm"),e=new FormData(e),t=$(this).attr("id");0<=e.get(t)?$(".object-table.linked-objects").find("select").not("#"+t).attr("disabled",1):$(".object-table.linked-objects").find("select").not("#"+t).removeAttr("disabled")},window.digiquali.object.selectAnswer=function(){var t=$(this).closest(".select-answer.answer-cell"),e=t.attr("data-questionId"),i=$(this).closest(".table-id-"+e).attr("data-publicInterface"),n=$(this).closest(".table-id-"+e).attr("data-autoSave");let a="";var s=$(this).hasClass("answer")?$(this).attr("value"):$(this).val(),o=$(this).closest(".table-id-"+e).find('input[name="comment'+e+'"]').val();if($(this).closest(".table-cell").hasClass("select-answer")){if($(this).hasClass("multiple-answers")){$(this).closest("span").toggleClass("active");let e=[];t.find(".multiple-answers.active").each(function(){e.push($(this).attr("value"))}),a=e}else $(this).closest(".table-cell").find(".answer.active").css("background-color","#fff"),$(this).closest(".table-cell").find("span").removeClass("active"),$(this).closest("span").addClass("active"),a=s;$(this).hasClass("active")?(t=$(this).closest(".answer-cell").find(".answer-color-"+$(this).attr("value")).val(),$(this).attr("style",$(this).attr("style")+" background:"+t+";")):$(this).attr("style",$(this).attr("style")+" background:#fff;"),$(this).closest(".answer-cell").find(".question-answer").val(a)}i||1!=n||$(this).hasClass("multiple-answers")?window.digiquali.object.updateButtonsStatus():window.digiquali.object.saveAnswer(e,a,o)},window.digiquali.object.changeStatusQuestion=function(){$(this).closest(".question").addClass("question-complete")},window.digiquali.object.showCommentUnsaved=function(){$(this).hasClass("show-comment-unsaved-message")||$(".question-answer-container").hasClass("question-answer-container-pwa")||($(this).after('<p style="color:red;">Commentaire non enregistré</p>'),$(this).addClass("show-comment-unsaved-message")),window.digiquali.object.updateButtonsStatus()},window.digiquali.object.updateButtonsStatus=function(){$("#saveButton").removeClass("butActionRefused"),$("#saveButton").addClass("butAction"),$("#saveButton").css("background","#0d8aff"),$(".fa-circle").css("display","inline"),$("#saveButton").attr("onclick",'$("#saveObject").submit()'),$(".validateButton").removeClass("butAction"),$("#dialog-confirm-actionButtonValidate").removeAttr("id"),$(".validateButton").addClass("butActionRefused")},window.digiquali.object.saveAnswer=function(e,t,i){var n=window.saturne.toolbox.getToken(),a=window.saturne.toolbox.getQuerySeparator(document.URL);$.ajax({url:document.URL+a+"action=save&token="+n,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({autoSave:!0,questionId:e,answer:t,comment:i}),success:function(e){$(".progress-info").replaceWith($(e).find(".progress-info")),$("#dialog-confirm-actionButtonValidate>.confirmmessage").replaceWith($(e).find("#dialog-confirm-actionButtonValidate>.confirmmessage"))},error:function(){}})},window.digiquali.object.rangePercent=function(e){var t=window.saturne.toolbox.isPhone(),i=$(this),n=parseFloat(i.val()),a=parseInt(i.attr("min")),s=parseInt(i.attr("max")),o=i.width(),d=i.position().left,l=i.position().top,c=t?36:70,r=i.closest(".table-id").attr("data-questionId"),u=$(this).closest(".table-id-"+r).attr("data-publicInterface"),w=$(this).closest(".table-id-"+r).attr("data-autoSave"),g=(i.parent().find(".range-percent").remove(),(Math.round(100*n)/100).toFixed(2)),p=$('<span class="range-percent">'+g+"%</span>"),l=(t||p.css("transform","translateX(0)"),p.addClass("badge badge-primary"),p.css("top",l-1.05*c/2-(t?10:5)+"px"),(n-a)/(s-a)),n=d+Math.round(l*o-(t?0:c/4)+-c*(l-.5));p.css("left",n),i.attr("value",g),i.parent().append(p),e||(u||1!=w||$(this).hasClass("multiple-answers")?window.digiquali.object.updateButtonsStatus():window.digiquali.object.saveAnswer(r,p,comment))},window.digiquali.object.placePercents=function(){$('.question-answer[type="range"]').each(function(){window.digiquali.object.rangePercent.call(this,!0)})},window.digiquali.question={},window.digiquali.question.init=function(){window.digiquali.question.event(),window.digiquali.question.changeMinMaxUnitLabelDependingQuestionType()},window.digiquali.question.event=function(){$(document).on("click",".clicked-photo-preview",window.digiquali.question.previewPhoto),$(document).on("click",".ui-dialog-titlebar-close",window.digiquali.question.closePreviewPhoto),$(document).on("click","#show_photo",window.digiquali.question.showPhoto),$(document).on("click",".answer-picto .item, .wpeo-table .item",window.digiquali.question.selectAnswerPicto),$(document).on("change",'select[data-type="question-type"]',window.digiquali.question.changeQuestionType)},window.digiquali.question.previewPhoto=function(){$(this).hasClass("photo-ok")?$("#dialogforpopup").attr("style","border: 10px solid #47e58e"):$(this).hasClass("photo-ko")&&$("#dialogforpopup").attr("style","border: 10px solid #e05353")},window.digiquali.question.closePreviewPhoto=function(){$("#dialogforpopup").attr("style","border:")},window.digiquali.question.showPhoto=function(){var e=$(this);e.closest(".question-table").find(".linked-medias").toggleClass("hidden",!e.prop("checked"))},window.digiquali.question.selectAnswerPicto=function(){var e=$(this).closest(".wpeo-dropdown");$(this).closest(".content").removeClass("active"),e.find(".dropdown-toggle span").hide(),e.find(".dropdown-toggle.button-picto").html($(this).closest(".wpeo-tooltip-event").html()),e.find(".input-hidden-picto").val($(this).data("label"))},window.digiquali.question.changeQuestionType=function(){var e=$(this).val(),t=("Percentage"===e?($(document).find("#percentage-question-step").removeClass("hidden"),$(document).find("#percentage-question-step input").prop("disabled",!1)):($(document).find("#percentage-question-step").addClass("hidden"),$(document).find("#percentage-question-step input").prop("disabled",!0)),JSON.parse($(this).attr("data-default-points")));$(document).find("#points").val(t[e]),JSON.parse($(this).attr("data-question-types-with-bounds")).includes(e)?($(document).find("#question-answer-min-value").removeClass("hidden"),$(document).find("#question-answer-max-value").removeClass("hidden"),$(document).find("#question-answer-min-value input").prop("disabled",!1),$(document).find("#question-answer-max-value input").prop("disabled",!1)):($(document).find("#question-answer-min-value").addClass("hidden"),$(document).find("#question-answer-max-value").addClass("hidden"),$(document).find("#question-answer-min-value input").prop("disabled",!0),$(document).find("#question-answer-max-value input").prop("disabled",!0)),window.digiquali.question.changeMinMaxUnitLabelDependingQuestionType()},window.digiquali.question.changeMinMaxUnitLabelDependingQuestionType=function(){"Percentage"===$("#selecttype").val()?$(".question-answer-min-max-unit").text(" (%)"):$(".question-answer-min-max-unit").text("")},window.digiquali.riskAssessment={},window.digiquali.riskAssessment.init=function(){window.digiquali.riskAssessment.event()},window.digiquali.riskAssessment.event=function(){$(document).on("click",".gravity-button",window.digiquali.riskAssessment.updateGravityPercentage),$(document).on("change",".gravity-percentage-input",window.digiquali.riskAssessment.updateGravityPercentage),$(document).on("click",".frequency-button",window.digiquali.riskAssessment.updateFrequencyPercentage),$(document).on("change",".frequency-percentage-input",window.digiquali.riskAssessment.updateFrequencyPercentage),$(document).on("input",".control-slider",window.digiquali.riskAssessment.updateControlPercentage),$(document).on("change",".control-percentage-input",window.digiquali.riskAssessment.updateControlPercentage),$(document).on("click","#riskassessment_add",function(){window.saturne.object.ObjectFromModal.call(this,"create","riskassessment")}),$(document).on("click","#riskassessment_edit",function(){window.saturne.object.ObjectFromModal.call(this,"update","riskassessment")})},window.digiquali.riskAssessment.initializeModalUIState=function(e){$(".gravity-button.selected").each(function(){$(this).trigger("click")}),e.find(".gravity-percentage-input").val()&&0===e.find(".gravity-button.selected").length&&e.find(".gravity-percentage-input").trigger("change"),e.find(".frequency-button.selected").each(function(){$(this).trigger("click")}),e.find(".frequency-percentage-input").val()&&0===e.find(".frequency-button.selected").length&&e.find(".frequency-percentage-input").trigger("change"),e.find(".control-slider").trigger("input"),e.find(".control-percentage-input").trigger("change"),window.digiquali.riskAssessment.updateModalRiskAssessmentButton(e)},window.digiquali.riskAssessment.updateGravityPercentage=function(){var e=$(this),t=e.closest(".modal-riskassessment");let i;e.is("button")?(i=e.data("gravity-value"),t.find(".gravity-button").removeClass("selected"),e.addClass("selected")):e.is("input")&&(i=window.saturne.utils.getSanitizedPercentageValue(e),e.val(i),(e=t.find(".gravity-button")).removeClass("selected"),e.each(function(){if($(this).data("gravity-value")===i)return $(this).addClass("selected"),!1})),t.find(".gravity-percentage-input").val(i),window.digiquali.riskAssessment.calculateAndDisplayRisks(t),window.digiquali.riskAssessment.updateModalRiskAssessmentButton(t)},window.digiquali.riskAssessment.updateFrequencyPercentage=function(){var e=$(this),t=e.closest(".modal-riskassessment");let i;e.is("button")?(i=e.data("frequency-value"),t.find(".frequency-button").removeClass("selected"),e.addClass("selected")):e.is("input")&&(i=window.saturne.utils.getSanitizedPercentageValue(e),e.val(i),(e=t.find(".frequency-button")).removeClass("selected"),e.each(function(){if($(this).data("frequency-value")===i)return $(this).addClass("selected"),!1})),t.find(".frequency-percentage-input").val(i),window.digiquali.riskAssessment.calculateAndDisplayRisks(t),window.digiquali.riskAssessment.updateModalRiskAssessmentButton(t)},window.digiquali.riskAssessment.updateControlPercentage=function(){var e=$(this),t=e.closest(".modal-riskassessment");let i;(e.is(".control-slider")?(i=window.saturne.utils.getSanitizedPercentageValue(e),t.find(".control-percentage-input")):e.is(".control-percentage-input")?(i=window.saturne.utils.getSanitizedPercentageValue(e),e.val(i),t.find(".control-slider")):(i=window.saturne.utils.getSanitizedPercentageValue(t.find(".control-percentage-input")),t.find(".control-slider").val(i),t.find(".control-percentage-input"))).val(i),window.digiquali.riskAssessment.calculateAndDisplayRisks(t),window.digiquali.riskAssessment.updateModalRiskAssessmentButton(t)},window.digiquali.riskAssessment.calculateAndDisplayRisks=function(e){var t=(i=window.saturne.utils.getSanitizedPercentageValue(e.find(".gravity-percentage-input"))/100*(window.saturne.utils.getSanitizedPercentageValue(e.find(".frequency-percentage-input"))/100))*(1-window.saturne.utils.getSanitizedPercentageValue(e.find(".control-percentage-input"))/100),i=(100*i).toFixed(2),t=(100*t).toFixed(2),n=e.find(".risk-percentage-value"),e=e.find(".residual-risk-percentage-value");n.text(i+"%"),e.text(t+"%"),75<=i?n.removeClass("grey yellow red").addClass("black"):50<=i?n.removeClass("grey yellow black").addClass("red"):25<=i?n.removeClass("grey red black").addClass("yellow"):n.removeClass("yellow red black").addClass("grey"),75<=t?e.removeClass("grey yellow red").addClass("black"):50<=t?e.removeClass("grey yellow black").addClass("red"):25<=t?e.removeClass("grey red black").addClass("yellow"):e.removeClass("yellow red black").addClass("grey")},window.digiquali.riskAssessment.updateModalRiskAssessmentButton=function(e){var t=e.find("#riskassessment_add, #riskassessment_edit"),i=window.saturne.utils.getSanitizedPercentageValue(e.find(".gravity-percentage-input")),n=window.saturne.utils.getSanitizedPercentageValue(e.find(".frequency-percentage-input")),e=window.saturne.utils.getSanitizedPercentageValue(e.find(".control-percentage-input")),i=!isNaN(i)&&0<=i&&i<=100,n=!isNaN(n)&&0<=n&&n<=100,e=!isNaN(e)&&0<=e&&e<=100;i&&n&&e?t.removeClass("button-disable").prop("disabled",!1):t.addClass("button-disable").prop("disabled",!0)},window.digiquali.riskAssessmentTask={},window.digiquali.riskAssessmentTask.init=function(){window.digiquali.riskAssessmentTask.event()},window.digiquali.riskAssessmentTask.event=function(){$(document).on("input",".label",window.digiquali.riskAssessmentTask.updateModalRiskAssessmentTaskButton),$(document).on("click","#riskassessment_task_add",function(){window.saturne.object.ObjectFromModal.call(this,"create","riskassessment_task")}),$(document).on("click","#riskassessment_task_edit",function(){window.saturne.object.ObjectFromModal.call(this,"update","riskassessment_task")})},window.digiquali.riskAssessmentTask.updateModalRiskAssessmentTaskButton=function(){var e=$(this).closest(".modal-riskassessment-task"),t=e.find("#riskassessment_task_add");0<e.find(".label").length?t.removeClass("button-disable"):t.addClass("button-disable")},window.digiquali.sheet={},window.digiquali.sheet.init=function(){window.digiquali.sheet.event(),window.digiquali.sheet.displayOpenedGroups()},window.digiquali.sheet.event=function(){$(document).on("click",".toggle-group-in-tree",window.digiquali.sheet.toggleGroupInTree),$(document).on("click",".addQuestionButton, .addGroupButton",window.digiquali.sheet.buttonActions),window.digiquali.sheet.initDragAndDropInParent();const i=JSON.parse(localStorage.getItem("digiqualiGroupStates")||"{}");$(".group-item").each(function(){var e=$(this).data("id"),t=$(this).next(".sub-questions");!1===i[e]?(t.addClass("collapsed"),$(this).find(".toggle-group-in-tree").removeClass("fa-chevron-right").addClass("fa-chevron-down")):!0===i[e]&&(t.removeClass("collapsed"),$(this).find(".toggle-group-in-tree").removeClass("fa-chevron-down").addClass("fa-chevron-right"))})},window.digiquali.sheet.displayOpenedGroups=function(){const t=JSON.parse(localStorage.getItem("digiqualiGroupStates")||"{}");$("#tablelines .question-group").each(function(){var e=$(this).data("id");!0===t[e]&&window.digiquali.sheet.toggleGroup(e)})},window.digiquali.sheet.buttonActions=function(e){var e=e.currentTarget.dataset.parentId,t=$("#addQuestionRow-"+e),e=$("#addGroupRow-"+e);("addQuestionButton"===$(this).data("action")?(t.removeClass("hidden"),e):("addGroupButton"===$(this).data("action")?e.removeClass("hidden"):e.addClass("hidden"),t)).addClass("hidden")},window.digiquali.sheet.toggleGroup=function(e){$(`.question[data-parent-id="${e}"]`).toggleClass("hidden");var t=$(`#group-${e} .toggle-icon`),i=$("#addLine-"+e),i=(i.toggleClass("hidden"),i.hasClass("hidden"));t.text(i?"+":"-"),i&&($("#addGroupRow-"+e).addClass("hidden"),$("#addQuestionRow-"+e).addClass("hidden")),window.digiquali.sheet.saveGroupState(e,!i)},window.digiquali.sheet.saveGroupState=function(e,t){var i=JSON.parse(localStorage.getItem("digiqualiGroupStates")||"{}");i[e]=t,localStorage.setItem("digiqualiGroupStates",JSON.stringify(i))},window.digiquali.sheet.closeAllGroups=function(){var e=$(".group-question"),t=$(".toggle-icon");e.addClass("hidden"),t.text("+")},window.digiquali.sheet.toggleGroupInTree=function(){var e=$(this).closest(".group-item"),t=e.data("id"),e=e.next(".sub-questions"),e=($(this).toggleClass("fa-chevron-up fa-chevron-down"),e.toggleClass("collapsed"),e.hasClass("collapsed"));window.digiquali.sheet.saveGroupState(t,!e)},window.digiquali.sheet.greyOut=function(){var e=$(".group-item"),t=$(".question-item"),i=$(".sheet-header");e.removeClass("selected"),t.removeClass("selected"),i.removeClass("selected")},window.digiquali.sheet.initDragAndDropInParent=function(){$("#tablelines tbody").sortable({handle:$(".sheet-move-line"),tolerance:"intersect",update:function(e,t){var i=t.item.closest("tr"),n=i.data("parentId");let a=0;t=t.item.index();if(0<n){let e=$("#tablelines tbody tr:nth-child("+(t+1)+")");for(;0<(e=e.prev()).length&&(!e.hasClass("question-group")||e.data("parentId")==n););if(e.data("id")!=n)return $("#dialog-moved-error").dialog({modal:!0,buttons:{Ok:function(){$(this).dialog("close")}}}),void $(this).sortable("cancel");a=e.data("id")}t=$(".fiche").find('input[name="token"]').val();let s="&",o=(document.URL.match(/action=/)&&(document.URL=document.URL.split(/\?/)[0],s="?"),[]),d=[],l=1;$(`#tablelines tr[data-parent-id="${a}"]`).each(function(e,t){var i={id:(t=$(t)).data("id"),position:l};t.hasClass("question-group")?d.push(i):t.hasClass("question")&&o.push(i),l++});var c={question_positions:o,questiongroup_positions:d};0<$(".side-nav .question-list").length&&window.saturne.loader.display($(".side-nav .question-list")),$.ajax({url:document.URL+s+"action=moveLine&token="+t+"&groupId="+a+"&movedItemId="+i.data("id")+"&movedItemType="+(i.hasClass("question")?"question":"questiongroup"),type:"POST",data:JSON.stringify(c),processData:!1,contentType:!1,success:function(e){$(".side-nav .question-list")&&($(".side-nav .question-list").html($(e).find(".side-nav .question-list")),window.saturne.loader.remove($(".side-nav .question-list"))),location.reload()},error:function(){}})}})},window.digiquali.task={},window.digiquali.task.init=function(){window.digiquali.task.event()},window.digiquali.task.event=function(){$(document).on("input","#answer-task-label",window.digiquali.task.updateModalTaskAddButton),$(document).on("click",".answer-task-create:not(.button-disable)",window.digiquali.task.createTask),$(document).on("click",".answer-task-save",window.digiquali.task.updateTask),$(document).on("click",".question__action .delete-task",window.digiquali.task.deleteTask),$(document).on("click",".answer-task-create:not(.button-disable)",window.digiquali.task.createTask),$(document).on("change",'.question__action-check input[type="checkbox"]',window.digiquali.task.checkTask),$(document).on("click",".modal-open",window.digiquali.task.autoFocusLabel),$(document).on("click",".answer-task-timespent-create",window.digiquali.task.createTaskTimeSpent),$(document).on("click",".answer-task-timespent-update",window.digiquali.task.updateTaskTimeSpent),$(document).on("click",".answer-task-timespent-delete",window.digiquali.task.deleteTaskTimeSpent)},window.digiquali.task.updateModalTaskAddButton=function(){var e=$(this),t=e.closest("#answer_task_add").find(".wpeo-button.answer-task-create");0<e.val().length?t.removeClass("button-disable"):t.addClass("button-disable")},window.digiquali.task.autoFocusLabel=function(){$(this).closest(".question-answer-container").find("#answer_task_add").find("#answer-task-label").focus()},window.saturne.modal.addMoreOpenModalData=function(t,e){var i=window.saturne.toolbox.getToken(),e=e.find(".modal-options").data("from-id");let n="fetch_task";t.match(/timespent_edit/)&&(n="fetch_task_timespent"),"activity_edit"!==t&&"riskassessment_list"!==t||(n="fetch_activity"),"riskassessment_update"===t&&(n="fetch_riskassessment"),$.ajax({url:`${document.URL}&action=${n}&token=`+i,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({from_id:e}),success:function(e){$("#"+t).replaceWith($(e).find("#"+t).addClass("modal-active")),"riskassessment_update"===t&&window.digiquali.riskAssessment.initializeModalUIState($("#"+t))}})},window.digiquali.task.createTask=function(){var e=window.saturne.toolbox.getToken();const t=$(this).closest("#answer_task_add"),i=t.data("from-id");var n=t.data("from-type");const a=$(document).find("#question_task_list"+i);var s=t.find("#answer-task-label").val(),o=t.find("#answer-task-start-date").val(),d=t.find("#answer-task-end-date").val(),l=t.find("#answer-task-budget").val(),c=t.data("project-id");$.ajax({url:document.URL+"&action=add_task&token="+e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({objectLine_id:i,objectLine_element:n,label:s,date_start:o,date_end:d,budget_amount:l,fk_project:c}),success:function(e){t.replaceWith($(e).find("#answer_task_add")),a.replaceWith($(e).find("#question_task_list"+i))}})},window.digiquali.task.updateTask=function(){var e=window.saturne.toolbox.getToken(),t=$(this);const i=t.closest("#answer_task_edit");var n=i.find(".answer-task-content");const a=t.data("task-id"),s=$(document).find(`#answer_task${a} .question__action-body`);var t=n.find("#answer-task-label").val(),o=n.find("#answer-task-start-date").val(),d=n.find("#answer-task-end-date").val(),n=n.find("#answer-task-budget").val();$.ajax({url:document.URL+"&action=update_task&token="+e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({task_id:a,label:t,date_start:o,date_end:d,budget:n}),success:function(e){i.removeClass("modal-active"),s.replaceWith($(e).find(`#answer_task${a} .question__action-body`))}})},window.digiquali.task.deleteTask=function(){var e=window.saturne.toolbox.getToken(),t=$(this);const i=t.closest(".question__list-actions");var n=i.data("objectline-id"),a=i.data("objectline-element"),s=t.data("task-id"),t=t.data("message");confirm(t)&&$.ajax({url:document.URL+"&action=delete_task&token="+e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({objectLine_id:n,objectLine_element:a,task_id:s}),success:function(e){var t=i.attr("id");i.replaceWith($(e).find("#"+t))}})},window.digiquali.task.checkTask=function(){var e=window.saturne.toolbox.getToken();const t=$(this).closest(".question__action"),i=t.data("task-id");window.saturne.loader.display(t),$.ajax({url:`${document.URL}&action=check_task&task_id=${i}&token=`+e,type:"POST",success:function(e){t.replaceWith($(e).find("#answer_task"+i))}})},window.digiquali.task.createTaskTimeSpent=function(){var e=window.saturne.toolbox.getToken(),t=$(this).closest("#answer_task_timespent_add");const i=t.data("task-id"),n=$(document).find("#answer_task"+i);var a=t.find("#answer-task-timespent-comment").val(),s=t.find("#answer-task-timespent-date").val(),t=t.find("#answer-task-timespent-duration").val();window.saturne.loader.display(n),$.ajax({url:document.URL+"&action=add_task_timespent&token="+e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({task_id:i,comment:a,date:s,duration:t}),success:function(e){n.replaceWith($(e).find("#answer_task"+i))}})},window.digiquali.task.updateTaskTimeSpent=function(){var e=window.saturne.toolbox.getToken(),t=$(this).closest("#answer_task_timespent_edit");const i=t.data("task-timespent-id"),n=$(document).find("#answer_task_timespent_view"+i);var a=t.find("#answer-task-timespent-comment").val(),s=t.find("#answer-task-timespent-date").val(),t=t.find("#answer-task-timespent-duration").val();window.saturne.loader.display(n),$.ajax({url:document.URL+"&action=update_task_timespent&token="+e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({task_timespent_id:i,comment:a,date:s,duration:t}),success:function(e){n.replaceWith($(e).find("#answer_task_timespent_view"+i))}})},window.digiquali.task.deleteTaskTimeSpent=function(){var e=window.saturne.toolbox.getToken(),t=$(this),i=t.closest("#answer_task_timespent_list");const n=i.find(".answer-task-timespent-container"),a=i.data("task-id"),s=$(document).find(`#answer_task${a} .question__action-body`);i=t.data("task-timespent-id"),t=t.data("message");confirm(t)&&(window.saturne.loader.display(n),window.saturne.loader.display(s),$.ajax({url:document.URL+"&action=delete_task_timespent&token="+e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({task_timespent_id:i}),success:function(e){n.replaceWith($(e).find(`#answer_task_timespent_list[data-task-id="${a}"] .answer-task-timespent-container`)),s.replaceWith($(e).find(`#answer_task${a} .question__action-body`))}}))};